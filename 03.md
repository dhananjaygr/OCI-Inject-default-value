# Exercise: Verify and Analyze your Cloud Environment
---

In this lab we will look into findings and discoveries made by the Workload Scanner triggered by the deployment of the Wiz Cloud connectors (AWS, Azure, GCP). More specifically, we will look into resources discovered, its techonologies, vulnerabilities, and network insights.<br>
Once the Cloud connector is deployed, Wiz begins to scan the environment using its agentless read-only APIs approach. With that, if during the Cloud scan the connector finds VMs, Functions, and Containers, it will trigger a workload scan for futher analyzis.
In this lab we will navigate through the scan findings, its details, how to analyze and address issues identified by the workload scanner.

---

> ‚ö° If you have just finished the Wiz Azure Connector deployment, you may have to wait until resources are fetched and ingested into the Graph. (approximately 30min)

---

## Task 1: Seek & Find

1. In Wiz, navigate to **Settings > Deployments**.

1. Find your Cloud connector on the list, or use the Search by name field

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-settings-deployments.png"/>
      </p>

1. Here you can already see some information about you Cloud connector:

    - Health Issues: usually tied to permission errors in the Cloud account. Some are informational and don't affect the connector operations, but some (High/Critical) may prevent the connector to work properly. 
    - Status: Active/Inactive
    - Source: Cloud account (AWS Account, Azure Subscription, GCP Project, etc)
    - Last Activity: last time the Cloud account was scanned

1. Click on the connector to expand the details

   <p align="left">
      <img style="width:580px; border:black; border-width:1px; border-style:solid;" img src="images/az-connector-details.png"/>
      </p>    

    - The **Details** show more information about the connector including its ID, creation date, Cloud Subscription details, and the Wiz Managed Identity used to make the API calls.
    ___
   
1. Still in the Details tab details tab of your connector, and click on Subscriptions

1. The portal will show all of the Subscriptions attached to the connector

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-subs.png"/>
      </p>  

   > ‚ö° It can take some time for all aspects of the connector findings to populate through the Wiz UI. If you do not see your subscription listed at this point, expand the following *Manual query to locate your subscription* section for a direct link to a Security Graph query to locate it.

   <details>
   <summary>Manual query to locate your subscription</summary>

   To manually locate your subscription on the Security Graph, copy the following URL and paste it into the web browser tab where you are viewing the Wiz console.

   <div style="margin-right: 150px;">

   ```plain
   https://app.wiz.io/explorer/graph#%7E%28view%7E%27table%7Equery%7E%28type%7E%28%7E%27SUBSCRIPTION%29%7Eselect%7Etrue%7Ewhere%7E%28subscriptionId%7E%28CONTAINS%7E%28%7E%27<inject key="SubscriptionId" enableCopy="false" />%29%29%29%29%29
   ```

   </div> 

1. Click on your Subscription to open the details drawer, navigate through its details. Here you can begin to see the power of Wiz, where in a matter of minutes, you have visibility into your Cloud environment.
    
    ---
    **Details**
   
   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-acct-details.png"/>
      </p>  
    ---

    **Issues**

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-acct-issues.png"/>
      </p>  
    ---

    **Configuration**

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-acct-config.png"/>
      </p>  
    ---

1. Close the Subscription details drawer. In the Resources column, click on the **"view virtual machines on the graph"** link.

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-vm-link.png"/>
      </p>  

   > ‚ö° If you used the previous manual link to locate your subscription on the Security Graph, expand the following *Manual query to locate your VM* section for a direct link to a Security Graph query to locate the VM for the following steps.

   <details>
   <summary>Manual query to locate your VM</summary>

   <div style="margin-right: 150px;">

   To manually locate all virtual machines in your subscription on the Security Graph, copy the following URL and paste it into the web browser tab where you are viewing the Wiz console.

   ```plain
   https://app.wiz.io/explorer/graph#%7E%28view%7E%27table%7Equery%7E%28type%7E%28%7E%27VIRTUAL_MACHINE%29%7Eselect%7Etrue%7Erelationships%7E%28%7E%28type%7E%28%7E%28type%7E%27CONTAINS%7Ereverse%7Etrue%29%29%7Ewith%7E%28type%7E%28%7E%27SUBSCRIPTION%29%7Eselect%7Etrue%7Ewhere%7E%28subscriptionId%7E%28CONTAINS%7E%28%7E%27<inject key="SubscriptionId" enableCopy="false" />%29%29%29%29%29%29%29%7Ecolumns%7E%28%7E%28%7E%270%7E35%29%7E%28%7E%270cloudPlatform%7E16%29%7E%28%7E%270status%7E16%29%7E%28%7E%271%7E24%29%7E%28%7E%271subscriptionId%7E14%29%7E%28%7E%271cloudPlatform%7E14%29%29%29
   ```

   </div>

1. Note that this graph query is tailored to your environment, using the Virtual Machine as the root object, filtering by an specific Subscription ID (in this case an Azure Subscription)

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-vmquery.png"/>
      </p>  

1. Click on MyVM to open the details drawer. In the Overview tab, you begin to see all the information collected by the Cloud Connector scanner, workload scanner, plus the Wiz enrichments.

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-vm-overview.png"/>
      </p>  

1. In the **Technologies** section, click on **Linux Ubuntu**

1. Here we see Linux Ubuntu as a **Hosted Technology** and all of the information collected by the workload scanner.

1. Click on the Vulnerability tab, and see that the Hosted Technology's version, which happens to be MYVM's Operating System, is End-of-Life.

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-ht.png"/>
      </p>  

1. You can further investigate by clicking on the Finding.

   <p align="left">
      <img style="width:780px; border:black; border-width:1px; border-style:solid;" img src="images/az-ht-finding.png"/>
      </p> 

1. Go back to the VM's detail drawer and browse other details. Try to find:
    - the workload scan results; 
    - all technologies installed in the VM; 
    - network exposure paths; 
    - VM's data inventory

<style>

@import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap');

aside {
   border-left: 4px solid #509128;
   padding-left: 12px;
   font-weight: 300;
   color: #434343;
   text-indent: -2px;
   align-items: center;
   margin-top: 6px;
   margin-bottom: 12px;
   line-height: 22px;
   font-size: 16px;
   letter-spacing: 0px;
}
aside::before {
   content: "üí° Tip";
   font-style: normal;
   margin-left: 2px;
   color: #509128;
   font-weight: 600;
   font-size: 14px;
   display: block;
}
aside.tip{
   border-color: #1f883d;
}
aside.tip::before{
   content: "üíÅ‚Äç‚ôÇ Tip";
   color: #1f883d;
}
aside.warning{
   border-color: #9a6701;
}
aside.warning::before{
   content: "‚ö†Ô∏è Warning";
   color: #9a6701;
}
aside.note{
   border-color: #0c69da;
}
aside.note::before{
   content: "üóí Note";
   color: #0c69da;
}
aside.important{
   border-color: #8250df;
}
aside.important::before{
   content: "üí¨ Important";
   color: #8250df;
}
aside.time{
    border-color: #3C4048;
}
aside.time::before{
    content: "üïê Time";
    color: #3C4048;
}
#guide-page,
#guide-page-,
#guideView{
    font-family: "DM Sans", sans-serif;
    font-optical-sizing: auto;
    font-weight: 300;
    font-style: normal;
    max-width: 1200px;
    color: #3C4048;
    margin: 12px 24px;
    letter-spacing: 0.1px;
}
#guide-page .variable-binding span.copydetails a:before,
#guide-page- .variable-binding span.copydetails a:before,
#guideView .variable-binding span.copydetails a:before{
    color: #0254EC;
    display: inline-block;
    vertical-align: text-bottom;
    height: 19px;
    line-height: 19px;
}
.appfooter{
    max-height:48px;
    display: none;
}
#guide-page a,
#guide-page- a,
#guideView a{
    color: #003AA4;
    background-color: transparent;
    cursor: pointer;
    outline: none;
    text-decoration: none;
    text-underline-offset: 4px;
    text-decoration-thickness: 1px;
}
#guide-page a:hover,
#guide-page- a:hover,
#guideView a:hover{
    text-decoration: underline;
    text-underline-offset: 4px;
    text-decoration-thickness: 1px;
}
#guide-page a:focus,
#guide-page- a:focus,
#guideView a:focus{
    outline: none;
    opacity: 0.9;
}
#guide-page u,
#guide-page- u,
#guideView u{
    text-underline-offset: 4px;
    text-decoration-thickness: 1px;
}
#guide-page strong,
#guide-page- strong,
#guideView strong{
    font-weight: 500;
}
#guide-page img,
#guide-page- img,
#guideView img{
    margin-bottom: 24px;
    width: 100%;
    max-width: 550px;
    border: 1px solid #7E7E7E;
    border-radius: 4px;
}
#guide-page code,
#guide-page- code,
#guideView code{
    color: #0254EC;
    background-color: #E8F0FF;
}
#guide-page pre code,
#guide-page- pre code,
#guideView pre code{
    color: #F9FCFF;
    background: none;
    display: block;
}
#guide-page .copydetails span,
#guide-page- .copydetails span,
#guideView .copydetails span{
    color: #0254EC;
    background-color: #E8F0FF;
    display: inline-block;
}
#guide-page .copydetails[aria-label^="[v"] span,
#guide-page- .copydetails[aria-label^="[v"] span,
#guideView .copydetails[aria-label^="[v"] span{
    color: #d5deef;
    display: block;
    font-size: 14px;
    font-family: monospace;
}
#guide-page .variable-binding pre,
#guide-page- .variable-binding pre,
#guideView .variable-binding pre{
    background: #001142;
    margin-top: -6px;
}
#guide-page a:hover[role="button"],
#guide-page- a:hover[role="button"],
#guideView a:hover[role="button"]{
    text-decoration: none;
}
#guide-page li > p + ol,
#guide-page- li > p + ol,
#guideView li > p + ol{
    margin-top: 3px;
    margin-bottom: 6px;
}
#guide-page p + ol,
#guide-page- p + ol,
#guideView p + ol{
    margin-top: -6px;
}
#guide-page ol > li > p,
#guide-page- ol > li > p,
#guideView ol > li > p{
    line-height: 22px;
}
#guide-page ol,
#guide-page- ol,
#guideView ol{
    line-height: 32px;
}
#guide-page ul,
#guide-page- ul,
#guideView ul{
    margin-bottom: 10px;
}
aside {
    font-size: 17px;
    line-height: 24px;
}
#guide-page,
#guide-page-,
#guideView{
    font-size: 18px;
}
aside::before {
    font-size: 16px;
}
#guide-page h1,
#guide-page- h1,
#guideView h1{
    font-size: 34px;
    margin-bottom: 18px;
}
#guide-page h2,
#guide-page- h2,
#guideView h2{
    font-size: 26px;
    margin-bottom: 14px;
}
#guide-page h3,
#guide-page- h3,
#guideView h3{
    font-size: 22px;
    margin-bottom: 12px;
}
#guide-page h4,
#guide-page- h4,
#guideView h4{
    font-size: 20px;
    margin-bottom: 12px;
}
.variable-binding span.copydetails span{
    font-size: 18px;
}
details > summary{
    font-weight: 700;
    font-size: 110%;
    color: #0254EC;
    padding: 24px 0px 24px 0px;
}
teams-button[aria-label="change vm 100% selected"] {
display: none;
}

</style>
